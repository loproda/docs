---
params:
  - product
---

import { Code } from "@astrojs/starlight/components";
import { Markdown, Render } from "~/components";

## Custom headers

The default response headers served on static asset responses can be overridden, removed, or added to, by creating a plain text file called `_headers` without a file extension, in the static asset directory of your project. This file will not itself be served as a static asset, but will instead be parsed by {props.product === 'workers' ? 'Workers' : 'Cloudflare Pages'} and its rules will be applied to static asset responses.

<Render
	product="workers"
	file="headers_redirects_directory"
	params={{ filename: "_headers", product: props.product }}
/>

Headers defined in the `_headers` file override what Cloudflare ordinarily sends.

:::caution

Custom headers defined in the `_headers` file are not applied to responses generated by {props.product === 'workers' ? 'your Worker code' : <a href="/pages/functions/">Pages Functions</a>}, even if the request URL matches a rule defined in `_headers`. If you use a server-side rendered (SSR) framework, {props.product === 'workers' ? <>have configured <code>assets.run_worker_first</code>, or otherwise use a Worker script</> : <>or Pages Functions (with either a folder of <a href="/pages/functions/routing/"><code>functions/</code></a> or an <a href="/pages/functions/advanced-mode/">"advanced mode" <code>{/* prettier-ignore-start */}_worker.js{/* prettier-ignore-end */}</code></a>)</>}, you will likely need to attach any custom headers you wish to apply directly within that {props.product === 'workers' ? 'Worker script' : 'Pages Functions code'}.

:::

### Attach a header

Header rules are defined in multi-line blocks. The first line of a block is the URL or URL pattern where the rule's headers should be applied. On the next line, an indented list of header names and header values must be written:

```txt
[url]
  [name]: [value]
```

Using absolute URLs is supported, though be aware that absolute URLs must begin with `https` and specifying a port is not supported. `_headers` rules ignore the incoming request's port and protocol when matching against an incoming request. For example, a rule like `https://example.com/path` would match against requests to `other://example.com:1234/path`.

You can define as many `[name]: [value]` pairs as you require on subsequent lines. For example:

<Code
	lang="txt"
	code={`# This is a comment\n/secure/page\n\tX-Frame-Options: DENY\n\tX-Content-Type-Options: nosniff\n\tReferrer-Policy: no-referrer\n\n/static/*\n\tAccess-Control-Allow-Origin: *\n\tX-Robots-Tag: nosnippet\n\n${props.product === "workers" ? "https://myworker.mysubdomain.workers.dev/*" : "https://myproject.pages.dev/*"}\n\tX-Robots-Tag: noindex`}
/>

An incoming request which matches multiple rules' URL patterns will inherit all rules' headers. Using the previous `_headers` file, the following requests will have the following headers applied:

| Request URL                                                                                                                                                 | Headers                                                                                                                               |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| `https://custom.domain/secure/page`                                                                                                                         | `X-Frame-Options: DENY` <br /> `X-Content-Type-Options: nosniff ` <br /> `Referrer-Policy: no-referrer`                               |
| `https://custom.domain/static/image.jpg`                                                                                                                    | `Access-Control-Allow-Origin: *` <br /> `X-Robots-Tag: nosnippet`                                                                     |
| <code>{props.product === 'workers' ? 'https://myworker.mysubdomain.workers.dev/home' : 'https://myproject.pages.dev/home'}</code>                           | `X-Robots-Tag: noindex`                                                                                                               |
| <code>{props.product === 'workers' ? 'https://myworker.mysubdomain.workers.dev/secure/page' : 'https://myproject.pages.dev/secure/page'}</code>             | `X-Frame-Options: DENY` <br /> `X-Content-Type-Options: nosniff` <br /> `Referrer-Policy: no-referrer` <br /> `X-Robots-Tag: noindex` |
| <code>{props.product === 'workers' ? 'https://myworker.mysubdomain.workers.dev/static/styles.css' : 'https://myproject.pages.dev/static/styles.css'}</code> | `Access-Control-Allow-Origin: *` <br /> `X-Robots-Tag: nosnippet, noindex`                                                            |

You may define up to 100 header rules. Each line in the `_headers` file has a 2,000 character limit. The entire line, including spacing, header name, and value, counts towards this limit.

If a header is applied twice in the `_headers` file, the values are joined with a comma separator.

### Detach a header

You may wish to remove a default header or a header which has been added by a more pervasive rule. This can be done by prepending the header name with an exclamation mark and space (`! `).

```txt
/*
  Content-Security-Policy: default-src 'self';

/*.jpg
  ! Content-Security-Policy
```

### Match a path

The same URL matching features that <a href={props.product === 'workers' ? '/workers/static-assets/redirects/' : '/pages/configuration/redirects/'}>`_redirects`</a> offers is also available to the `_headers` file. Note, however, that redirects are applied before headers, so when a request matches both a redirect and a header, the redirect takes priority.

#### Splats

When matching, a splat pattern — signified by an asterisk (`*`) — will greedily match all characters. You may only include a single splat in the URL.

The matched value can be referenced within the header value as the `:splat` placeholder.

#### Placeholders

<Render
	product="workers"
	file="headers_redirects_placeholders"
	params={{ filetype: "header" }}
/>

```txt
/movies/:title
  x-movie-name: You are watching ":title"
```

#### Examples

##### Cross-Origin Resource Sharing (CORS)

To enable other domains to fetch every static asset from your {props.product === 'workers' ? 'Worker' : 'Pages project'}, the following can be added to the `_headers` file:

```txt
/*
  Access-Control-Allow-Origin: *
```

This applies the `Access-Control-Allow-Origin` header to any incoming URL. To be more restrictive, you can define a URL pattern that applies to a <code>{props.product === 'workers' ? '\*.\*.workers.dev' : '\*.pages.dev'}</code> subdomain, which then only allows access from its {props.product === 'workers' ? <a href="/workers/configuration/previews/">preview URLs</a> : <><code>staging</code> branch's subdomain</>}:

<Code
	lang="txt"
	code={
		props.product === "workers"
			? `https://:worker.:subdomain.workers.dev/*\n\tAccess-Control-Allow-Origin: https://*-:worker.:subdomain.workers.dev/`
			: `https://:project.pages.dev/*\n\tAccess-Control-Allow-Origin: https://staging.:project.pages.dev/`
	}
/>

##### Prevent your workers.dev URLs showing in search results

[Google](https://developers.google.com/search/docs/advanced/robots/robots_meta_tag#directives) and other search engines often support the `X-Robots-Tag` header to instruct its crawlers how your website should be indexed.

For example, to prevent your {props.product === 'workers' ? <code>\*.\*.workers.dev</code> : <><code>\*.pages.dev</code> and <code>\*.\*.pages.dev</code></>} URLs from being indexed, add the following to your `_headers` file:

<Code
	lang="txt"
	code={
		props.product === "workers"
			? `https://:version.:subdomain.workers.dev/*\n\tX-Robots-Tag: noindex`
			: `https://:project.pages.dev/*\n\tX-Robots-Tag: noindex\n\nhttps://:version.:project.pages.dev/*\n\tX-Robots-Tag: noindex`
	}
/>

##### Configure custom browser cache behavior

If you have a folder of fingerprinted assets (assets which have a hash in their filename), you can configure more aggressive caching behavior in the browser to improve performance for repeat visitors:

```txt
/static/*
  Cache-Control: public, max-age=31556952, immutable
```

##### Harden security for an application

:::caution

If you are server-side rendering (SSR) or using {props.product === 'workers' ? 'a Worker' : 'Pages Functions'} to generate responses in any other way and wish to attach security headers, the headers should be sent from the {props.product === 'workers' ? "Worker's" : "Pages Functions'"} `Response` instead of using a `_headers` file. For example, if you have an API endpoint and want to allow cross-origin requests, you should ensure that your Worker code attaches CORS headers to its responses, including to `OPTIONS` requests.

:::

You can prevent click-jacking by informing browsers not to embed your application inside another (for example, with an `<iframe>`) with a [`X-Frame-Options`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Frame-Options) header.

[`X-Content-Type-Options: nosniff`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Content-Type-Options) prevents browsers from interpreting a response as any other content-type than what is defined with the `Content-Type` header.

[`Referrer-Policy`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Referrer-Policy) allows you to customize how much information visitors give about where they are coming from when they navigate away from your page.

Browser features can be disabled to varying degrees with the [`Permissions-Policy`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Permissions-Policy) header (recently renamed from `Feature-Policy`).

If you need fine-grained control over your application's content, the [`Content-Security-Policy`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Content-Security-Policy) header allows you to configure a number of security settings, including similar controls to the `X-Frame-Options` header.

```txt
/app/*
  X-Frame-Options: DENY
  X-Content-Type-Options: nosniff
  Referrer-Policy: no-referrer
  Permissions-Policy: document-domain=()
  Content-Security-Policy: script-src 'self'; frame-ancestors 'none';
```
