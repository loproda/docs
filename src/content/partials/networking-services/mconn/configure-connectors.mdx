---
params:
  - magicWord
  - productName
  - wan
  - lan
  - noConnectorShows
  - shippedLanguage
  - hardSoftConn
  - finalInstructions
---

import { AnchorHeading, Aside, Card, Code, GlossaryTooltip, Markdown, Render, Tabs, TabItem } from "~/components";

{ props.magicWord === "virtual" && (
	<>
		<p>Virtual Magic WAN Connector (Virtual Connector) is a virtual appliance alternative to the hardware based Magic WAN Connector appliance. These two versions of Connector are identical otherwise.</p> <p>Currently, you can set up Virtual Connector on VMWare ESXi and Proxmox Virtual Environment. Support for Proxmox is in beta.</p>
	</>
	)
}

In this page you will find instructions on how to configure Magic WAN Connector. This guide provides a step-by-step guide for Magic WAN Connector's initial setup. You can either return here after setting up your Connector, or refer to the [Maintenance](/magic-wan/configuration/connector/maintenance/) section where you will find instructions on how to update your settings.

## Prerequisites

{ props.magicWord === "hardware" && (
  <>
		<Markdown
		text={`
		You need to purchase [Magic WAN](https://www.cloudflare.com/magic-wan/) before you can purchase and use the Magic WAN Connector. The Magic WAN Connector can function as your primary edge device for your network, or be deployed in-line with existing network gear.

		You also need to purchase a Magic WAN Connector before you can start configuring your settings in the Cloudflare dashboard. Contact your account representative to learn more about purchasing options for the Magic WAN Connector device.
		`}
		inline={false}
		/>
  </>
  )
}

{ props.magicWord === "virtual" && (
  <>
		<Markdown
		text={`
		Before you can install Virtual Connector, you need an Enterprise account with Magic WAN enabled. Additionally, you need to have a VMware or Proxmox host with sufficient compute, memory, and storage to run the virtual machine with Virtual Connector. This includes:
    - Intel x86 CPU architecture
    - ESXi hypervisor 7.0U1 or higher
    - 4 virtual CPUs per virtual connector (We recommend deployment with a 1:1 virtual CPU to physical core allocation to avoid CPU over contention which will cause packet loss.)
    - 8 GB of RAM per virtual connector
    - 8 GB of disk per virtual connector
    - One vSwitch port group or VLAN with access to the Internet (for example, through a WAN)
    - One or more vSwitch port group or VLAN that will be the internal LAN

    If you are installing Virtual Connector on ESXi, refer to [VMware's documentation](https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.esxi.install.doc/GUID-B2F01BF5-078A-4C7E-B505-5DFFED0B8C38.html) for more information on how to install ESXi and configure a virtual machine.

		If you are installing Virtual Connector on Virtual Environment, refer to [Proxmox documentation](https://www.proxmox.com/en/products/proxmox-virtual-environment/get-started) for more information on how to install Virtual environment and configure a virtual machine.
		`}
		inline={false}
		/>

  </>
  )
}

---

## Before you begin

There are a couple of decisions you need to make when installing your {props.productName}. Refer to the topics below for more information.

### Determine the need for a high availability configuration

You can install up to two {props.productName}s for redundancy at each of your sites. If one of your Connectors fails, traffic will fail over to the other Connector ensuring that you never lose connectivity to that site.

In this type of high availability (HA) configuration, you will choose a reliable LAN interface as the HA link which will be used to monitor the health of the peer connector. HA links can be dedicated links or can be shared with other LAN traffic.

You must decide the type of configuration you want for your site from the beginning: no redundancy or with redundancy. You cannot add redundancy after finishing the configuration of your dashboard settings. If, at a later stage, you decide to enable redundancy, you will need to delete your Connector on-ramp in the Cloudflare dashboard, and start again.

<Card title="Do you need a high availability configuration?" icon="information">

- If you need a high availability configuration for your premises, refer to
  [About high availability configurations](#about-high-availability-configurations) for more information
  and learn how to configure your Connector in this mode.

- If you do not need a high availability configuration for you premises, check if you need a [DHCP or a static IP setup](#decide-on-dhcp-vs-static-ip-connections) before proceeding to [Set up Cloudflare dashboard](#set-up-cloudflare-dashboard).

</Card>

:::caution
You cannot enable high availability for an existing Connector on-ramp. To add high availability to an existing Connector on-ramp in the Cloudflare dashboard, you need to delete the on-ramp and start again. Plan accordingly to create a high availability configuration from the start if needed.
:::


### Decide on DHCP vs static IP connections

{ props.magicWord === "hardware" && (
  <>
    <p>You can use Magic WAN Connector in both DHCP networks and networks that require a static IP configuration. At first boot, however, Magic WAN Connector needs to reach out to Cloudflare to download your settings and go through the activation process. If any of the networks plugged into your Connector are DHCP enabled, does not use a VLAN, and have an Internet connection, that process is handled automatically. However, if all of the networks require more information to utilize, (such as a network with static IPs, or tagged VLAN networks) your Magic WAN Connector might need some more information to proceed.</p>

		<p>There are couple of ways to provide this information. Choose the one that fits your workflow: </p>

		<AnchorHeading title="Option one - Activate on a DHCP Network" depth={4} />

		<Markdown
		text={`
		1. Connect Magic WAN Connector to a DHCP port with access to the Internet.
		2. Go through the [setup flow](#set-up-cloudflare-dashboard) below and activate your Connector.
		3. Refer to [WAN with a static IP address](#wan-with-a-static-ip-address).
		`}
		inline={false}
		/>

		<AnchorHeading title="Option two - Bootstrap via Serial Console" depth={4} />
		<p>Refer to the <a href="#bootstrap-via-serial-console"> Bootstrap workflow</a>.</p>

  </>
  )
}

{ props.magicWord === "virtual" && (
  <>
    <p>Virtual Connector uses a DHCP connection at first boot to download your settings and go through the activation process. However, if you need to use a static IP in your Virtual Connector, and this is a fresh install:</p>

		<Markdown
		text={`
    1. Connect the machine with your Virtual Connector VM to a DHCP port with access to the Internet.
		2. Go through the [setup flow](#set-up-cloudflare-dashboard) below and activate your Connector.
		3. Refer to [WAN with a static IP address](#wan-with-a-static-ip-address).
		`}
		inline={false}
		/>
  </>
  )
}

---

{ props.magicWord === "hardware" && (
  <>
		<AnchorHeading title="Port speeds" depth={2} />
		<Markdown
		text={`
		The hardware version of the Magic WAN connector includes two [SFP+ ports](https://en.wikipedia.org/wiki/Small_Form-factor_Pluggable) that support 10G throughput, as well as six RJ45 ports that support 1G throughput.

		Refer to [SFP+ port information](/magic-wan/configuration/connector/configure-hardware-connector/sfp-port-information/) for details on this topic.
		`}
		inline={false}
		/>
  </>
  )
}

{ props.magicWord === "virtual" && (
  <>
		<AnchorHeading title="Configure a virtual machine" depth={2} />
		<p>Select the appropriate tab below to learn how to configure Virtual Connector on VMWare ESXi or Proxmox Virtual Environment.</p>

		<Tabs> <TabItem label="VMWare ESXi">

		<Markdown
		text={`
		**1. Obtain the VMWare image**

		Contact your account team at Cloudflare to obtain the Virtual Connector OVA package and license keys. The OVA image includes the files required to install and configure the virtual machine (VM) for Virtual Connector with the appropriate settings. Refer to [VMWare VMs documentation](https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.vm_admin.doc/GUID-AE61948B-C2EE-436E-BAFB-3C7209088552.html) for more information on this topic.

		This image can be deployed multiple times to create several instances of a Virtual Connector, in different locations or on the same ESXi host.

		You will consume one license key for each instance created. For example, if you want to deploy 10 Virtual Connectors you should request 10 license keys, and your account team will create 10 Connector instances in your Cloudflare dashboard.
		`}
		inline={false}
		/>

		<Markdown
		text={`

		**2. Deploy the Virtual Connector on VMware**

		The following instructions assume you already have VMware ESXi hypervisor installed with sufficient resources. Refer to [Prerequisites](#prerequisites) for more information.

		1. When setting up your VMware ESXi, you need to create port groups for Virtual Connector. Go to **Networking** > **Port groups**, and prepare your vSwitch port groups and/or VLANs for your desired network topology. For example, a simple deployment typically has:
			- A WAN port group where the Virtual Connector will get an IP address (static or DHCP) that has access to the Internet.
			- A LAN port group, where the Virtual Connector will act as default router, and possibly DHCP server.
			- A null, or unused, port group for allocating unused virtual interfaces in the Virtual Connector. You can, for example, create a null port group with the name of <code>Null port group</code>, and a **VLAN ID** of <code>999</code>.
		`}
		inline={false}
		/>

		<Render file="mconn/vlan-tagging" product="networking-services" params={{	url: "[VMware's documentation](https://kb.vmware.com/s/article/1003825)" }}/>

		<Markdown
		text={`
		2. Extract the files in the OVA image provided by your Cloudflare account team. For example:
		`}
		inline={false}
		/>

		<Code lang="sh" code="tar -xvf mconn-2024-1-3.ova" />

		<Markdown
		text={`
		Take note of the folder where you are extracting the files to, as you will need to refer to that folder when creating the VM.

		3. Go to **Virtual Machines** > **Create/Register VM** wizard to start deploying the Virtual Connector.

		4. Select **Deploy a virtual machine from an OVF or OVA file** > **Next**.

		5. Choose a descriptive name for your virtual machine.

		6. Upload the files you have extracted from the OVA image. These include <code>mconn.ovf</code>, <code>mconn.nvram</code>, and <code>mconn.vmdk</code>.

		7. Select where you want to save the files extracted from the OVA image > **Next**.

		8. In **Networking mappings**, select assignments for your desired topology according to the port groups you set up previously:
			1. For example, map <code>eno1</code> port to <code>VM Network</code> to create your WAN, and <code>eno2</code> to <code>LAN0</code> to act as your LAN port.
			2. Allocate any unused ports to the <code>null</code> port group.
			3. Take note of your configuration. You will need this information to configure your network in the Cloudflare dashboard.

		9. In **Disk provisioning**, select **Thin**.

		10. Before completing the deployment wizard, disable **Power on automatically**. This is important so that you can configure the license key prior to boot.

		11. Configure the virtual machine with the license key your account team provided you:
			1. Select the Virtual Connector's VM > **Settings**.
			2. Go to **VM Options** > **Advanced** > **Edit Configuration**.
			3. Select **Add parameter** to add your license key. Scroll down to the last entry (this is where VMware adds the new parameter), and add the following two new entries:
				- **Key**: <code>guestinfo.cloudflare.identity</code>
				- **Value** \`<YOUR_LICENSE_KEY>\`
		`}
		inline={false}
		/>

		<Render file="mconn/licence-keys" product="networking-services" />

		<Markdown
		text={`
			12. Select **Save** to finish configuring your Virtual Connector.
			13. Continue setup in your <a href="#set-up-cloudflare-dashboard">Cloudflare dashboard.</a>
		`}
		inline={false}
		/>

		</TabItem> <TabItem label="Proxmox Virtual Environment (beta)">

		<Markdown
		text={`
		**1. Obtain the Virtual Connector script**

		Contact your account team at Cloudflare to obtain your license keys and the Virtual Connector script for Proxmox. The script will set up and configure a Proxmox virtual machine with the appropriate settings for Virtual Connector. Refer to [Prerequisites](#prerequisites) for more information on system requirements.

		The script can be deployed multiple times to create several instances of a Virtual Connector, in different locations or on the same Proxmox host. You will consume one license key for each instance created. For example, if you want to deploy 10 Virtual Connectors you should request 10 license keys.

		**2. Deploy the Virtual Connector on Proxmox**

		The following instructions assume you already have Proxmox Virtual Environment installed with sufficient resources. Refer to [Prerequisites](#prerequisites) for more information.

		1. In the terminal prompt of your Proxmox server, load the script provided by your account team. For example: \`bash YOUR_SCRIPT\`. You need elevated privileges to run the script.
		2. You will be prompted to create a new Virtual Connector. Select **yes** to proceed.
		3. Set up your Virtual Connector name.
		4. Enter your license key.
				`}
		inline={false}
		/>

		<Render file="mconn/licence-keys" product="networking-services" />

		<Markdown
		text={`
		5. Select the network interface card (NIC) you want to use with Virtual Connector.
		6. Select the network bridge that corresponds to the physical network interface card (NIC) on your host machine. This bridge allows the network adapter in the virtual machine to communicate through the NIC in the host, as if it were directly connected to the physical network.
		7. (Optional) Configure your VLAN setting if needed.
		`}
		inline={false}
		/>

		<Render file="mconn/vlan-tagging" product="networking-services" params={{	url: "[Proxmox documentation](https://www.proxmox.com/en/products/proxmox-virtual-environment/get-started)" }}/>

		<Markdown
		text={`
		8. Finish your configuration.
		9. The script will apply your settings and configure the virtual machine template for Virtual Connector.
		10. In the **Hardware settings** for the new VM, make sure the hardware settings match the minimum requirements for running Virtual Connector. Make changes to the RAM and CPU if needed.
		11. Continue setup in your [Cloudflare dashboard](#set-up-cloudflare-dashboard).
		`}
		inline={false}
		/>

		</TabItem> </Tabs>
  </>
  )
}

---

## Set up Cloudflare dashboard

{ props.magicWord === "hardware" && (
  <>
		<AnchorHeading title="Register your appliance" depth={3} />
		<p>To set up and use Magic WAN Connector, you first need to register it with your account.</p>
		<Render file="register-hardware-appliance" product="networking-services/mconn" />
  </>
  )
}

### Add a Connector on-ramp

You need to add your Connector to your Cloudflare dashboard and configure its settings before connecting it to the Internet.

To add a Connector on-ramp:

1. Log in to the [Cloudflare dashboard](https://dash.cloudflare.com/) and select your account.
2. Go to **Magic WAN** > **Connector on-ramps (beta)**.
3. Select **Add**.
4. In **Name**, enter a descriptive name for your Connector. Optionally, you can also add a description for it.
5. You need to decide if you want to turn on high availability for the Connector. Refer to [About high availability configurations](#about-high-availability-configurations) for more information.
6. Select **Create and continue**.
7. Select **Add Connector**. This will show you a list of Magic WAN Connector devices associated with your account. <Markdown text={props.noConnectorShows} />
8. If you have more than one Connector, choose the one that corresponds to the on-ramp you are creating. Connectors are identified by a serial number, also known as a service tag. Use this information to choose the right Connector. Select **Select Connector** when you are ready to proceed.
9. The Connector will be added to your account with an **Interrupt window** defined. The interrupt window is the time period when the Magic WAN Connector software can update, which may result in interruption to existing connections. You can change this later. Refer to [Interrupt window](/magic-wan/configuration/connector/maintenance/interrupt-service-window/) for more details on how to define when the Connector can update its systems.
10. Select **Continue** to proceed to creating your WAN and LAN networks.

### Create a WAN

<Tabs syncKey="dashPlusAPI"> <TabItem label="Dashboard">

1. In **WAN configuration**, select **Create**. You can create one or more [wide area networks (WANs)](https://www.cloudflare.com/learning/network-layer/what-is-a-wan/). Configuring multiple WANs will create multiple <GlossaryTooltip term="IPsec tunnel">IPsec</GlossaryTooltip> tunnels (one IPsec tunnel per WAN port). This allows the Connector to load balance traffic over WANs of equal priority. It also allows Connector to failover between circuits according to their <GlossaryTooltip term="tunnel health-check" link="/magic-wan/reference/tunnel-health-checks/">health</GlossaryTooltip>. Refer to [WAN settings](/magic-wan/configuration/connector/reference/#wan-settings) for more details.
		:::note
		This is not the same as a high availability (HA) configuration. HA configurations need two Connectors to work. Refer to [About high availability configurations](#about-high-availability-configurations) for more information.
		:::
2. In **Interface name**, enter a descriptive name for your WAN.
3. **Interface number** <Markdown text={props.wan} />
4. In **VLAN ID**, enter a number between `0` and `4094` to specify a [VLAN ID](/magic-wan/configuration/connector/reference/#vlan-id).
5. In **Priority**, choose the priority for your WAN. Lower numbers have higher priority. Refer to <GlossaryTooltip term="traffic steering" link="/magic-wan/reference/traffic-steering/">Traffic steering</GlossaryTooltip> to learn more about how Cloudflare calculates priorities.
6. In **Health check rate** configure the health check frequency for your site. Options are `low`, `mid`, and `high`. Refer to [Update tunnel health checks frequency](/magic-wan/configuration/common-settings/update-tunnel-health-checks-frequency/) for more information.
7. **Addressing**: Select **DHCP**. This is needed the first time you set up your Connector to successfully download all settings to the machine and activate it. If you need a static IP address in your network environment:
	1. Continue the set up flow below to activate your Connector.
	2. Refer to [WAN with a static IP address](#wan-with-a-static-ip-address). If you choose a static IP, you also need to specify the static IP and gateway addresses.
8. Select **Save** when you are finished.

</TabItem> <TabItem label="API">

<Render file="account-id-api-key" product="networking-services" />

Make a `POST` request [using the API](/api/resources/magic_transit/subresources/sites/subresources/wans/methods/create/) to create a WAN.

The `static_addressing` object is optional. Omit it if you are using DHCP. If you are using static addressing, add the `secondary_address` parameter when your site is in high availability (HA) mode.

Example:

```bash
curl https://api.cloudflare.com/client/v4/accounts/{account_id}/magic/sites/{site_id}/wans \
--header "X-Auth-Email: <EMAIL>" \
--header "X-Auth-Key: <API_KEY>" \
--header "Content-Type: application/json" \
--data '{
	"name": "<YOUR_WAN_NAME>",
	"physport": 1,
	"priority": 0,
	"vlan_tag": 0
}'
```

</TabItem> </Tabs>

### Create a LAN

<Tabs syncKey="dashPlusAPI"> <TabItem label="Dashboard">

1. In **LAN configuration**, select **Create**.
2. Enter a descriptive name for your LAN in **Interface name**.
3. **Interface number** <Markdown text={props.lan} />
4. In **VLAN ID**, specify a [VLAN ID](/magic-wan/configuration/connector/reference/#vlan-id) to create virtual LANs.
5. In **Static addressing** > **Static address** give your Connector's LAN interface its IP address. You can also enable the following options if they suit your use case:
   - **This is a DHCP server**: If your Connector is a [DHCP server](/magic-wan/configuration/connector/network-options/dhcp/dhcp-server/).
   - **This is a DHCP relay**: If your Connector is a [DHCP relay](/magic-wan/configuration/connector/network-options/dhcp/dhcp-relay/).
6. (Optional) In **Directly attached subnet** > **Static NAT prefix**, enter a CIDR prefix to enable NAT (network address translation). The prefix you enter here should be the same size as the prefix entered in **Static addressing**. For example, both networks have a subnet mask of `/24`: `192.168.100.0/24` and `10.10.100.0/24`.
7. (Optional) If your LAN contains additional subnets behind a layer 3 router, select **Add routed subnet** under **Routed subnets** to add them:
   - **Prefix**: The CIDR prefix for the subnet behind the L3 router.
   - **Next hop**: The address of the L3 router to which the Connector should forward packets for this subnet.
   - **Static NAT prefix**: Optional setting. If you want to enable NAT for a routed subnet, supply an "external" prefix for the overlay-facing side of the NAT to use. It must be the same size as **Prefix**. <br /> Refer to [Routed subnets](/magic-wan/configuration/connector/network-options/routed-subnets/) for more information.
8. Select **Save**.
9. Select **Done** to finish your configuration. Tunnels and <GlossaryTooltip term="static route">static routes</GlossaryTooltip> will be automatically created for your Magic WAN Connector, once it boots up.

</TabItem> <TabItem label="API">

<Render file="account-id-api-key" product="networking-services" />

Make a `POST` request [using the API](/api/resources/magic_transit/subresources/sites/subresources/lans/methods/create/) to create a LAN.

Example:

```bash
curl https://api.cloudflare.com/client/v4/accounts/{account_id}/magic/sites/{site_id}/lans \
--header "X-Auth-Email: <EMAIL>" \
--header "X-Auth-Key: <API_KEY>" \
--header "Content-Type: application/json" \
--data '{
	"name": "<YOUR_LAN_NAME>",
	"physport": 2,
	"static_addressing": {
		"address": "172.16.14.0/24"
	},
	"vlan_tag": 0
}'
```

</TabItem> </Tabs>

#### Network segmentation

After setting up your LANs, you can configure your Connector to enable communication between them without traffic leaving your premises. Refer to [Network segmentation](/magic-wan/configuration/connector/network-options/network-segmentation/) for more information.

#### DHCP options

Magic WAN Connector supports different types of DHCP configurations. Connector can:

- Connect to a DHCP server or use a static IP address instead of connecting to a DHCP server.
- Act as a [DHCP server](/magic-wan/configuration/connector/network-options/dhcp/dhcp-server/).
- Use [DHCP relay](/magic-wan/configuration/connector/network-options/dhcp/dhcp-relay/) to connect to a DHCP server outside the location your Magic WAN Connector is in.
- [Reserve IP addresses](/magic-wan/configuration/connector/network-options/dhcp/dhcp-static-address-reservation/) for specific devices on your network.

Refer to [DHCP options](/magic-wan/configuration/connector/network-options/dhcp/) to learn more.

### Add your Connector to a site

After finishing your Connector configuration, you need to add it to a site. <Render file="sites-brief" product="networking-services" />

{ props.magicWord === "hardware" && (
  <>
		<AnchorHeading title="Set up your Magic WAN Connector" depth={2} />

		<AnchorHeading title="Device installation" depth={3} />
		<p>There are several deployment options for Magic WAN Connector. Connector can act like a DHCP server for your local network, or integrate with your local setup and have static IP addresses assigned to it.</p>
		<p>When Connector acts like the WAN router for your site, deployment will be something like this:</p>

		<pre class="mermaid">
		{`flowchart LR
		accTitle: Magic WAN Connector set up as a DHCP server, and connecting to the Internet.
    a(Magic WAN Connector)--> b(Internet) --> c(Cloudflare)

    subgraph Customer site
    d[LAN 1] --> a
    e[LAN 2] --> a
    end

    classDef orange fill:#f48120,color: black
    class a,c orange`}
		</pre>

		<p>In the example below, the Connector sits behind the WAN router in your site, and on-ramps only some of the existing LANs to Cloudflare.</p>

		<pre class="mermaid">
		{`flowchart LR
		accTitle: Magic WAN Connector connects to the router in the site, and only some of the LANs connect to Connector.
    a(Magic WAN Connector)--> b((Site's router)) --> c(Internet) --> i(Cloudflare)

    subgraph Customer site
    d[LAN 1] --> a
    e[LAN 2] --> a
    g(LAN 3) --> b
    h(LAN 4) --> b
    end

    classDef orange fill:#f48120,color: black
    class a,i orange`}
		</pre>

		<p>Refer to <a href="/reference-architecture/diagrams/sase/magic-wan-connector-deployment/">Magic WAN Connector deployment options</a> for a high-level explanation of the deployment options that make sense to most environments, as well as a few advanced use cases.</p>

		<AnchorHeading title="Firewall settings required" depth={4} />
		<p>If there is a firewall deployed upstream of the Magic WAN Connector, configure the firewall to allow the following traffic:</p>

		<Markdown
			text={`
	| Protocol/port | Destination IP/URL | Purpose |
	| --- | --- |--- |
	| \`UDP/53\` | DNS destination IP \`1.1.1.1\` | Needed to allow DNS traffic to Cloudflare DNS servers. Cloudflare uses this port for DNS lookups of control plane API. |
	| \`TCP/443\` | - | The Connector will open outbound HTTPS connections over this port for control plane operations. |
	| \`UDP/4500\` | Destination IP \`162.159.64.1\` | Needed for Connector's initialization and discovery traffic through outbound connections. |
	| \`UDP/4500\` | Destination IP - Cloudflare anycast IPs | Needed for the Cloudflare anycast IPs assigned to your account for tunnel outbound connections. This traffic is tunnel traffic. |
	| \`TCP/7844\`, \`UDP/7844\` | Outbound connections | This is for debugging facilities in the Connector. |
	| \`UDP/123\` | \`http://time.cloudflare.com/\` | Needed for Magic WAN Connector to periodically contact Cloudflare's Time Services. |
	`}
		inline={false}
	/>

  </>
  )
}

## Activate Connector

{props.shippedLanguage}, and will only establish a connection to the Cloudflare network when it is activated. Cloudflare recommends leaving it deactivated until you finish [setting it up in the dashboard](#set-up-cloudflare-dashboard).

{ props.magicWord === "hardware" && (
  <>
		<p>When the Connector is first activated, you need to have Internet connection. If you chose to set up your Connector with DHCP you will need to have one of the Connector ports connected to the Internet through a device that supports DHCP. This is required so that the Connector can reach the Cloudflare global network and download the required configurations that you <a href="#set-up-cloudflare-dashboard">set up</a>.</p>
		<p> If you set up your Connector with a static IP through the bootstrap method, you do not need a DHCP port. Refer to <a href="#decide-on-dhcp-vs-static-ip-connections"> DHCP vs static IP connections</a> for more information.</p>

		<Aside type="caution">Remember that if you chose the DHCP method you have to connect Magic WAN Connector through a route that supports DHCP for its first connection to the Internet. Otherwise, the Connector will not work.</Aside>
  </>
  )
}

{ props.magicWord === "virtual" && (
  <>
		<p>When the Connector is first activated, one of the ports must be connected to the Internet through a device that supports DHCP. This is required so that the Connector can reach the Cloudflare global network and download the required configurations that you <a href="#set-up-cloudflare-dashboard">set up</a>.</p>

		<Aside type="caution">Remember to connect Magic WAN Connector through a route that supports DHCP for its first connection to the Internet. Otherwise, the Connector will not work.</Aside>

  </>
  )
}

When you are ready to connect your Magic WAN Connector to the Cloudflare network:

1. Log in to the [Cloudflare dashboard](https://dash.cloudflare.com/) and select your account.
2. Go to **Magic WAN** > **Configuration** > **Connectors**.
3. Find the Connector you want to activate, select the three dots next to it > **Edit**. Make sure you verify the serial number to choose the right connector you want to activate.
4. In the new window, the **Status** dropdown will show as **Deactivated**. Select it to change the status to **Activated**.
5. The **Interrupt window** is the time period when the Magic WAN Connector software can update, which may result in interruption to existing connections. Choose a time period to minimize disruption to your sites. Refer to [Interrupt window](/magic-wan/configuration/connector/maintenance/interrupt-service-window/) for more details on how to define when the Connector can update its systems.
6. Select **Update**.

{ props.magicWord === "virtual" && (
  <>
		<AnchorHeading title="Boot your Virtual Connector" depth={2} />

		<Markdown
		text={`
		1. Boot up Virtual Connector's VM in your virtual machine.
		2. The Virtual Connector will make a request to Cloudflare. This is the step where Virtual Connector registers your provided license key and downloads the [configuration you provided](#set-up-cloudflare-dashboard).
		3. The Virtual Connector will set up the LAN and WAN connections according to the configuration downloaded from the site you created on the Cloudflare dashboard. The Virtual Connector will also establish IPsec tunnels.
		4. If successful, the [tunnel health checks](/magic-wan/configuration/common-settings/check-tunnel-health-dashboard/) will show as healthy.
		5. If you do not see a [healthy heartbeat](/magic-wan/configuration/connector/maintenance/heartbeat/) on the Cloudflare dashboard, reboot the Virtual Connector's VM in VMware.
		`}
		inline={false}
		/>

		<AnchorHeading title="Default password to access Virtual Connector" depth={2} />

		<Markdown
		text={`
		Your Virtual Connector's default password is the last seven characters of your license key, all uppercase, plus an <code>!</code> (exclamation mark).

		For example, if your license key is <code>mconn-abcdefghijklmnopqrstuvwxyz</code>, your default password will be <code>TUVWXYZ!</code>.
		`}
		inline={false}
		/>
  </>
  )
}

---

## WAN with a static IP address

{ props.magicWord === "hardware" && (
  <>
    <p>After activating your Connector, you can use it in a network configuration with the WAN interface set to a static IP address â€” that is, an Internet configuration that is not automatically set by DHCP. To use your Connector on a network configuration with a static IP, follow the steps below.</p>

		<Aside type="caution">Make sure you complete the setup workflow and activate your Magic WAN Connector before changing the WAN settings to a static IP.</Aside>

		<Markdown
		text={`
		1. Connect Magic WAN Connector to a DHCP port with access to the Internet.
		2. [Add a Connector on-ramp](#add-a-connector-on-ramp) in the Cloudflare dashboard.
		3. Create a [DHCP WAN](#create-a-wan).
		4. [Activate](#activate-connector) and power on your Connector.
		5. Wait 60 seconds.
		6. Make changes to the [WAN settings](#create-a-wan) in the Cloudflare dashboard to a static IP set up.
		7. Wait 60 seconds again.
		8. Magic WAN Connector will go offline. This is normal and expected behavior.
		9. Adjust your physical connections as required to match the static configuration.
		10. Magic WAN Connector comes back online.
		`}
		inline={false}
		/>
  </>
  )
}

{ props.magicWord === "virtual" && (
  <>
		<p>After activating your Virtual Connector, you can use it in a network configuration with the WAN interface set to a static IP address - that is, an Internet configuration that is not automatically set by DHCP. To use your Virtual Connector on a network configuration with a static IP, follow the steps below.</p>

		<Aside type="caution">Make sure you complete the setup workflow and activate your Virtual Connector before changing the WAN settings to a static IP.</Aside>

		<Markdown
		text={`
		1. Connect the machine where you installed the VM with Virtual Connector to a DHCP port with access to the Internet.
		2. [Add a Connector on-ramp](#add-a-connector-on-ramp) in the Cloudflare dashboard.
		3. Create a [DHCP WAN](#create-a-wan).
		4. [Activate](#activate-connector) and boot your Virtual Connector.
		5. Wait 60 seconds.
		6. Make changes to the [WAN settings](#create-a-wan) in the Cloudflare dashboard to a static IP set up.
		7. Wait 60 seconds again.
		8. Modify your [Port Groups](#deploy-the-virtual-connector-on-vmware) as needed to change the source from which the WAN port obtains its IP address.
		9. Reboot your virtual machine.
		`}
		inline={false}
		/>
  </>
  )
}

{ props.magicWord === "hardware" && (
  <>
		<AnchorHeading title="Bootstrap via Serial Console" depth={2} />
		<p>Advanced users can locally configure their Magic WAN Connector to work in a static IP configuration. This local method does not require having access to a DHCP Internet connection. However, it does require being comfortable with using tools to access the serial port on Magic WAN Connector as well as using a serial terminal client to access the Connector's environment.</p>
		<p>Below is a detailed description of how to use the serial port to configure your Magic WAN Connector locally.</p>

		<Aside type="note">The <code>reset device</code> option in your Connector clears most of the configuration that is locally cached, resets the password to the default, and reboots.</Aside>

		<AnchorHeading title="Equipment required" depth={3} />

		<Markdown
		text={`
		To access the serial port on Magic WAN Connector you will need the following equipment:

		- The Magic WAN Connector appliance
		- A Phillips-head screwdriver
		- A micro-USB to USB-A cable (there should be one included in the packaging of your Connector)
		- A computer with an available USB port
		- A serial terminal client
		- Optional: if needed, a USB-A to USB-C converter dongle if your computer requires it
		`}
		inline={false}
		/>


		<AnchorHeading title="1. Access Magic WAN Connector's serial port" depth={3} />

		<Markdown
		text={`
		1. Using the Phillips screwdriver, loosen the screw covering the serial console panel on the back of the Magic WAN Connector and turn the panel out of the way.
			- Pictures and more instructions can be found on [Dell's Technical Documents](https://www.dell.com/support/kbdoc/en-us/000134440/how-to-access-console-port-of-dell-emc-networking-virtual-edge-platform-1405-series).
		2. Connect your computer to the Magic WAN Connector using the USB cable.
		`}
		inline={false}
		/>

		<AnchorHeading title="Default password to access Connector" depth={4} />
		<p>Your Connector's default password is the serial number (also known as a Service Tag for Dell devices), all uppercase followed by an <code>!</code> (for example, <code>A1B2C3D!</code>)</p>

		<AnchorHeading title="2. Install a serial terminal client" depth={3} />
		<p>To access Magic WAN Connector's environment you need a serial terminal client. Follow the instructions below to install one, based on your operating system.</p>

		<AnchorHeading title="Windows" depth={4} />

		<Markdown
		text={`
		Cloudflare recommends using PuTTY for Windows. Download PuTTY from the [official website](https://www.putty.org/) and then install it.

		1. Check the COM port of the USB to UART device in the Windows Device Manager. It should show up as something similar to <code>Silicon Labs CP210x USB to UART Bridge (COMX)</code>.
		2. Take note of the value in the parentheses (COMX).
			- Refer to the [Dell Documentation Page](https://infohub.delltechnologies.com/l/virtual-edge-platform-vep-1405-series-diag-os-and-tools-release-notes/bios-installation-and-configuration) for more details on creating a serial console connection.
		3. Launch PuTTY.
		4. Under **Category**, make sure that **Session** (the first item) is selected.
		5. Under **Connection type**, select **Serial**.
		6. In the **Serial Line**, type in the COM port found in step 2 (for example, <code>COM1</code>).
		7. In the **Speed**, enter <code>115200</code>.
		8. Select Open on the bottom of the dialog box. A terminal window should pop up.
		9. The screen may need to be manually refreshed when a new device is connected. You can do that by pressing <code>CTRL + C</code>.
		`}
		inline={false}
		/>

		<AnchorHeading title="macOS" depth={4} />

		<Markdown
		text={`
		Cloudflare recommends installing Screen for macOS. You can install Screen via <code>brew install screen</code>. If you do not have <code>brew</code> installed, follow the instructions on [Brew's Official Website](https://brew.sh/) to install it.

		1. Open the macOS Terminal.
		2. Run <code>ls /dev/cu.*</code> to list the connected serial devices.
		3. The command should return an output similar to <code>/dev/cu.usbserial-0001</code>. Copy this output to the clipboard or note this down somewhere else.
		4. Run \`sudo screen -adRUS mconn <PATH_FROM_STEP_3> 115200\`.
		5. The screen may need to be manually refreshed when a new device is connected. You can do that by pressing <code>CMD + C</code>.
		`}
		inline={false}
		/>

		<AnchorHeading title="Linux" depth={4} />

		<Markdown
		text={`
		Cloudflare recommends installing Screen for Linux. You can install Screen via your package manager of choice. For example, for Debian/Ubuntu, install by running <code>sudo apt update && sudo apt install screen</code>

		1. Open Terminal.
		2. List the connected serial devices by running <code>ls /dev/serial/by-id/*</code>.
		3. The command should return an output similar to <code>/dev/serial/by-id/usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0</code>. Copy this to the clipboard or note this down.
		4. Run \`sudo screen -adRUS mconn <PATH_FROM_STEP_3> 115200\`.
		5. The screen may need to be manually refreshed when a new device is connected. You can do that by pressing <code>CTRL + C</code>.
		`}
		inline={false}
		/>

		<AnchorHeading title="3. Configure a static IP on Magic WAN Connector" depth={3} />
		<p>The <code>reset device</code> option in your Connector clears most of the configuration that is locally cached, resets the password to the default, and reboots.</p>

		<Markdown
		text={`
		1. Log into the Connector. You will be prompted to change your password if you attempt to log in with the default password.
		2. From the menu, go to **Bootstrap** with the arrow keys and select it with the Enter key.
		3. Select the jack (physical port) you want to configure for the initialization of the connector.
		4. Enter the VLAN tag (if applicable) of the network. Leave it blank if untagged.
		5. Select the <code>static</code> option as your network type.
		`}
		inline={false}
		/>

		<Aside>The main reason to use the bootstrapper is if every network the Connector is plugged into is either static, behind a VLAN, or both. If you find yourself here and configuring a network with DHCP and no VLAN, you are probably not in the right place. See the section on configuring your Connector <a href="#set-up-cloudflare-dashboard">via the dashboard</a>.</Aside>

		<Markdown
		text={`
		6. Enter the IP address you would like the connector to have in CIDR form (for example, <code>10.0.0.2/24</code>).
		7. Enter the IP address of the Internet gateway (this must be in the same subnet as the previous IP address you entered and must not be the same address).
		8. Select **Save** and confirm that you want to use the new settings.
		9. The Connector will download the rest of the settings from Cloudflare. The last heartbeat of the Connector should update once it has made contact with Cloudflare.
		`}
		inline={false}
		/>
  </>
  )
}

---

## About high availability configurations

{props.hardSoftConn} When you set up a site in high availability, the WANs and LANs in your Connectors have the same configuration but are replicated on two nodes. In case of failure of a Connector, the other Connector becomes the active node, taking over configuration of the LAN gateway IP and allowing traffic to continue without disruption.

Because Connectors in high availability configurations share a single site, you need to set up:

- **Static address**: The IP for the primary node in your site.
- **Secondary static address**: The IP for the secondary node in your site.
- **Virtual static address**: The IP that the LAN south of the Connector will forward traffic to, which is the LAN's gateway IP.

Make sure all IPs are part of the same subnet.

For detailed information about the expected behavior of high availability configurations, refer to [High availability configurations](/magic-wan/configuration/connector/reference/#high-availability-configurations).

### Create a high availability configuration

You cannot enable high availability for an existing site. To add high availability to an existing site in the Cloudflare dashboard, you need to delete the site and start again.

To set up a high availability configuration:

1. Follow the steps in [Add a Connector on-ramp](#add-a-connector-on-ramp) up until step 4.
2. After naming your site, select **Turn on high availability**.
3. Select **Create and continue**.
4. Select **Add Connector**.
5. From the list, choose your first Connector > **Add Connector**.
6. Back on the previous screen, select **Add secondary Connector**.
7. From the list, choose your second Connector > **Add Connector**.
8. Select **Continue** to [Create a WAN](#create-a-wan). If you are configuring a static IP, configure the IP for the primary node as the static address, and the IP for the secondary node as the secondary static address.
9. To create a LAN, follow the steps mentioned above in [Create a LAN](#create-a-lan) up until step 4.
10. In **Static address**, enter the IP for the primary node in your site. For example, `192.168.10.1/24`.
11. In **Secondary static address**, enter the IP for the secondary node in your site. For example, `192.168.10.2/24`.
12. In **Virtual static address**, enter the IP that the LAN south of the Connector will forward traffic to. For example, `192.168.10.3/24`.
13. Select **Save**.
14. From the **High availability probing link** drop-down menu, select the port that should be used to monitor the node's health. Cloudflare recommends you choose a reliable interface as the HA probing link. The primary and secondary node's probing link should be connected over a switch, and cannot be a direct connection.
15. <Markdown text={props.finalInstructions} />

---

## IPsec tunnels and static routes

Magic WAN Connector automatically creates [IPsec tunnels](/magic-wan/reference/gre-ipsec-tunnels/#ipsec-tunnels) and [static routes](/magic-wan/reference/traffic-steering/) for you. You cannot configure these manually.

To check the IPsec tunnels and static routes created by your Magic WAN Connector:

1. Log in to the [Cloudflare dashboard](https://dash.cloudflare.com/) and select your account.
2. Go to **Magic WAN** > **Sites**.
3. Select the name of the site for which you want to check the Connector's IPsec tunnels and static routes, and select **Edit**.
4. Select **Tunnels** to check IPsec tunnels, and **Routes** for the static routes.

---

## Next steps

- [Network options](/magic-wan/configuration/connector/network-options/)
- [Maintenance](/magic-wan/configuration/connector/maintenance/)
- [Reference information](/magic-wan/configuration/connector/reference/)
- [Troubleshooting](/magic-wan/configuration/connector/troubleshooting/)
